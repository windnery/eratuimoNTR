; 身体素质成长系统
@UPDATE_BODY_GROWTH, ARG:1, ARG:2, ARG:3
; 更新身体素质
; ARG:1 = 角色编号
; ARG:2 = 素质类型
; ARG:3 = 经验值增加量
LOCAL = GET_PALAM(ARG:1, ARG:2)
LOCAL += ARG:3
CALL SET_PALAM, ARG:1, ARG:2, LOCAL

; 根据经验值自动升级相关素质
IF ARG:2 == 29  ; 乳交经验
	LOCAL:1 = GET_PALAM(ARG:1, 42)  ; 胸部大小
	IF LOCAL >= 50 AND LOCAL:1 < 20
		CALL SET_PALAM, ARG:1, 42, LOCAL:1 + 1  ; 胸部增大
		CALL SET_PALAM, ARG:1, 37, GET_PALAM(ARG:1, 37) + 2  ; 胸部敏感度增加
	ELSEIF LOCAL >= 100 AND LOCAL:1 < 30
		CALL SET_PALAM, ARG:1, 42, LOCAL:1 + 2
		CALL SET_PALAM, ARG:1, 37, GET_PALAM(ARG:1, 37) + 3
	ELSEIF LOCAL >= 200 AND LOCAL:1 < 40
		CALL SET_PALAM, ARG:1, 42, LOCAL:1 + 3
		CALL SET_PALAM, ARG:1, 37, GET_PALAM(ARG:1, 37) + 4
	ENDIF
	
	; 泌乳体质觉醒
	IF LOCAL >= 300 AND GET_CHARA_TALENT(ARG:1, 130) == 0  ; 没有泌乳体质
		PRINTL 【频繁的胸部刺激让你的身体发生了变化...】
		PRINTL 【你感觉胸部开始分泌乳汁...】
		CALL SET_CHARA_TALENT, ARG:1, 130, 1  ; 获得泌乳体质
		CALL SET_PALAM, ARG:1, 5, GET_PALAM(ARG:1, 5) + 10  ; 母乳量增加
	ENDIF
ELSEIF ARG:2 == 28  ; 口交经验
	LOCAL:1 = GET_PALAM(ARG:1, 51)  ; 小穴大小
	IF LOCAL >= 100 AND LOCAL:1 < 25
		; 口交经验丰富会导致小穴松弛
		CALL SET_PALAM, ARG:1, 52, MAX(0, GET_PALAM(ARG:1, 52) - 1)  ; 紧致度下降
	ENDIF
ELSEIF ARG:2 == 30  ; 阴道性交经验
	LOCAL:1 = GET_PALAM(ARG:1, 51)  ; 小穴大小
	LOCAL:2 = GET_PALAM(ARG:1, 48)  ; 小穴敏感度
	
	IF LOCAL >= 50 AND LOCAL:1 < 20
		CALL SET_PALAM, ARG:1, 51, LOCAL:1 + 1
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 3
	ELSEIF LOCAL >= 150 AND LOCAL:1 < 30
		CALL SET_PALAM, ARG:1, 51, LOCAL:1 + 2
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 5
	ELSEIF LOCAL >= 300 AND LOCAL:1 < 40
		CALL SET_PALAM, ARG:1, 51, LOCAL:1 + 3
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 7
	ENDIF
	
	; 爱液分泌增加
	CALL SET_PALAM, ARG:1, 58, MIN(100, GET_PALAM(ARG:1, 58) + LOCAL / 100)
	
	; 高潮经验影响敏感度
	LOCAL:3 = GET_PALAM(ARG:1, 59)  ; 高潮次数
	IF LOCAL:3 >= 10 AND LOCAL:2 < 50
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 2
	ELSEIF LOCAL:3 >= 30 AND LOCAL:2 < 70
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 3
	ELSEIF LOCAL:3 >= 50 AND LOCAL:2 < 90
		CALL SET_PALAM, ARG:1, 48, LOCAL:2 + 4
	ENDIF
ELSEIF ARG:2 == 31  ; 肛交经验
	LOCAL:1 = GET_PALAM(ARG:1, 61)  ; 肛门大小
	LOCAL:2 = GET_PALAM(ARG:1, 60)  ; 肛门敏感度
	
	IF LOCAL >= 50 AND LOCAL:1 < 15
		CALL SET_PALAM, ARG:1, 61, LOCAL:1 + 1
		CALL SET_PALAM, ARG:1, 60, LOCAL:2 + 3
	ELSEIF LOCAL >= 150 AND LOCAL:1 < 25
		CALL SET_PALAM, ARG:1, 61, LOCAL:1 + 2
		CALL SET_PALAM, ARG:1, 60, LOCAL:2 + 5
	ELSEIF LOCAL >= 300 AND LOCAL:1 < 35
		CALL SET_PALAM, ARG:1, 61, LOCAL:1 + 3
		CALL SET_PALAM, ARG:1, 60, LOCAL:2 + 7
	ENDIF
	
	; 菊纹变深
	CALL SET_PALAM, ARG:1, 64, MIN(100, GET_PALAM(ARG:1, 64) + LOCAL / 200)
ENDIF
RETURN

@GET_BREAST_SIZE_TEXT, ARG:1
; 获取胸部大小描述
#FUNCTION
LOCAL = GET_PALAM(ARG:1, 42)  ; 胸部大小

SELECTCASE LOCAL
	CASE <= 10
		RETURNF "贫乳"
	CASE <= 20
		RETURNF "微乳"
	CASE <= 30
		RETURNF "普通"
	CASE <= 40
		RETURNF "巨乳"
	CASE <= 50
		RETURNF "爆乳"
	CASE <= 60
		RETURNF "超乳"
	CASEELSE
		RETURNF "怪物级"
ENDSELECT

@GET_VAGINA_SIZE_TEXT, ARG:1
; 获取小穴大小描述
#FUNCTION
LOCAL = GET_PALAM(ARG:1, 51)  ; 小穴大小

SELECTCASE LOCAL
	CASE <= 5
		RETURNF "处女级紧致"
	CASE <= 15
		RETURNF "普通紧致"
	CASE <= 25
		RETURNF "适度松弛"
	CASE <= 35
		RETURNF "明显松弛"
	CASE <= 45
		RETURNF "严重松弛"
	CASEELSE
		RETURNF "洞窟级"
ENDSELECT

@GET_VAGINA_TIGHTNESS_TEXT, ARG:1
; 获取小穴紧致度描述
#FUNCTION
LOCAL = GET_PALAM(ARG:1, 52)  ; 小穴紧致度

SELECTCASE LOCAL
	CASE >= 90
		RETURNF "极致紧致"
	CASE >= 70
		RETURNF "非常紧致"
	CASE >= 50
		RETURNF "适度紧致"
	CASE >= 30
		RETURNF "轻微松弛"
	CASE >= 10
		RETURNF "明显松弛"
	CASEELSE
		RETURNF "完全松弛"
ENDSELECT

@GET_ANUS_SIZE_TEXT, ARG:1
; 获取肛门大小描述
#FUNCTION
LOCAL = GET_PALAM(ARG:1, 61)  ; 肛门大小

SELECTCASE LOCAL
	CASE <= 5
		RETURNF "处女肛门"
	CASE <= 15
		RETURNF "普通肛门"
	CASE <= 25
		RETURNF "适度扩张"
	CASE <= 35
		RETURNF "明显扩张"
	CASE <= 45
		RETURNF "严重扩张"
	CASEELSE
		RETURNF "隧道级"
ENDSELECT

@GET_SENSITIVITY_TEXT, ARG:1, ARG:2
; 获取敏感度描述
#FUNCTION
LOCAL = GET_PALAM(ARG:1, ARG:2)  ; 敏感度数值

SELECTCASE LOCAL
	CASE <= 10
		RETURNF "迟钝"
	CASE <= 30
		RETURNF "普通"
	CASE <= 50
		RETURNF "敏感"
	CASE <= 70
		RETURNF "非常敏感"
	CASE <= 90
		RETURNF "极度敏感"
	CASEELSE
		RETURNF "超敏感"
ENDSELECT

@GET_BODY_STATUS
; 查看身体状态
CLEARLINE 1
PRINTL 【身体状态详细】
PRINTL 

; 胸部状态
PRINTL 【胸部状态】
PRINTFORML 大小：{GET_PALAM(1, 42)} - {GET_BREAST_SIZE_TEXT(1)}
PRINTFORML 敏感度：{GET_PALAM(1, 37)} - {GET_SENSITIVITY_TEXT(1, 37)}
PRINTFORML 乳头敏感度：{GET_PALAM(1, 38)} - {GET_SENSITIVITY_TEXT(1, 38)}
PRINTFORML 乳交经验：{GET_PALAM(1, 29)}
PRINTFORML 母乳量：{GET_PALAM(1, 5)}
IF GET_CHARA_TALENT(1, 130) == 1
	PRINTL 泌乳体质：已觉醒
ENDIF
PRINTL 

; 小穴状态
PRINTL 【小穴状态】
PRINTFORML 大小：{GET_PALAM(1, 51)} - {GET_VAGINA_SIZE_TEXT(1)}
PRINTFORML 紧致度：{GET_PALAM(1, 52)} - {GET_VAGINA_TIGHTNESS_TEXT(1)}
PRINTFORML 敏感度：{GET_PALAM(1, 48)} - {GET_SENSITIVITY_TEXT(1, 48)}
PRINTFORML 阴蒂敏感度：{GET_PALAM(1, 49)} - {GET_SENSITIVITY_TEXT(1, 49)}
PRINTFORML 性交经验：{GET_PALAM(1, 30)}
PRINTFORML 高潮次数：{GET_PALAM(1, 59)}
PRINTFORML 爱液分泌量：{GET_PALAM(1, 58)}
PRINTL 

; 肛门状态
PRINTL 【肛门状态】
PRINTFORML 大小：{GET_PALAM(1, 61)} - {GET_ANUS_SIZE_TEXT(1)}
PRINTFORML 紧致度：{GET_PALAM(1, 62)}
PRINTFORML 敏感度：{GET_PALAM(1, 60)} - {GET_SENSITIVITY_TEXT(1, 60)}
PRINTFORML 肛交经验：{GET_PALAM(1, 31)}
PRINTFORML 菊纹深浅：{GET_PALAM(1, 64)}
PRINTL 

; 其他经验
PRINTL 【其他经验】
PRINTFORML 自慰经验：{GET_PALAM(1, 27)}
PRINTFORML 口交经验：{GET_PALAM(1, 28)}
PRINTFORML 群交经验：{GET_PALAM(1, 32)}
PRINTFORML 露出经验：{GET_PALAM(1, 33)}
PRINTFORML 束缚经验：{GET_PALAM(1, 34)}
PRINTFORML 羞辱经验：{GET_PALAM(1, 35)}
PRINTL 

WAIT
RETURN

@APPLY_SEX_EVENT_EFFECTS, ARG:1, ARG:2, ARG:3
; 应用性事件效果
; ARG:1 = 事件类型
; ARG:2 = 激烈程度
; ARG:3 = 持续时间

SELECTCASE ARG:1
	CASE 0  ; 乳交
		CALL UPDATE_BODY_GROWTH, 1, 29, ARG:2 * 2  ; 乳交经验
		CALL SET_PALAM, 1, 42, MIN(100, GET_PALAM(1, 42) + ARG:2 / 10)  ; 胸部大小
		CALL SET_PALAM, 1, 37, MIN(100, GET_PALAM(1, 37) + ARG:2 / 5)  ; 胸部敏感度
		CALL SET_PALAM, 1, 38, MIN(100, GET_PALAM(1, 38) + ARG:2 / 5)  ; 乳头敏感度
		
		IF ARG:2 >= 50  ; 激烈乳交可能触发泌乳
			IF RAND:100 < ARG:2 / 10
				CALL SET_PALAM, 1, 5, MIN(100, GET_PALAM(1, 5) + 5)  ; 母乳量
			ENDIF
		ENDIF
		
	CASE 1  ; 口交
		CALL UPDATE_BODY_GROWTH, 1, 28, ARG:2 * 3  ; 口交经验
		CALL SET_PALAM, 1, 51, MIN(100, GET_PALAM(1, 51) + ARG:2 / 20)  ; 小穴大小（轻微）
		CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - ARG:2 / 50)  ; 紧致度下降
		
	CASE 2  ; 阴道性交
		CALL UPDATE_BODY_GROWTH, 1, 30, ARG:2 * 5  ; 性交经验
		CALL SET_PALAM, 1, 51, MIN(100, GET_PALAM(1, 51) + ARG:2 / 10)  ; 小穴大小
		CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - ARG:2 / 20)  ; 紧致度下降
		CALL SET_PALAM, 1, 48, MIN(100, GET_PALAM(1, 48) + ARG:2 / 5)  ; 小穴敏感度
		CALL SET_PALAM, 1, 49, MIN(100, GET_PALAM(1, 49) + ARG:2 / 5)  ; 阴蒂敏感度
		CALL SET_PALAM, 1, 58, MIN(100, GET_PALAM(1, 58) + ARG:2 / 10)  ; 爱液分泌
		
		; 高潮记录
		IF ARG:2 >= 30 AND RAND:100 < 70
			CALL SET_PALAM, 1, 59, GET_PALAM(1, 59) + 1  ; 高潮次数
			CALL SET_PALAM, 1, 9, 100  ; 绝顶感
		ENDIF
		
	CASE 3  ; 肛交
		CALL UPDATE_BODY_GROWTH, 1, 31, ARG:2 * 4  ; 肛交经验
		CALL SET_PALAM, 1, 61, MIN(100, GET_PALAM(1, 61) + ARG:2 / 10)  ; 肛门大小
		CALL SET_PALAM, 1, 62, MAX(0, GET_PALAM(1, 62) - ARG:2 / 20)  ; 紧致度下降
		CALL SET_PALAM, 1, 60, MIN(100, GET_PALAM(1, 60) + ARG:2 / 5)  ; 肛门敏感度
		CALL SET_PALAM, 1, 64, MIN(100, GET_PALAM(1, 64) + ARG:2 / 30)  ; 菊纹加深
		
	CASE 4  ; 群交
		CALL UPDATE_BODY_GROWTH, 1, 32, ARG:2 * 6  ; 群交经验
		; 群交对所有部位都有影响
		CALL SET_PALAM, 1, 51, MIN(100, GET_PALAM(1, 51) + ARG:2 / 15)
		CALL SET_PALAM, 1, 61, MIN(100, GET_PALAM(1, 61) + ARG:2 / 15)
		CALL SET_PALAM, 1, 42, MIN(100, GET_PALAM(1, 42) + ARG:2 / 30)
		CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - ARG:2 / 25)
		CALL SET_PALAM, 1, 62, MAX(0, GET_PALAM(1, 62) - ARG:2 / 25)
		
	CASE 5  ; 内射
		IF RAND:100 < 20  ; 受孕可能性
			CALL SET_PALAM, 1, 95, MIN(100, GET_PALAM(1, 95) + 10)
		ENDIF
		CALL SET_PALAM, 1, 20, MIN(100, GET_PALAM(1, 20) + ARG:2 / 10)  ; 淫乱度
		CALL SET_PALAM, 1, 16, MIN(100, GET_PALAM(1, 16) + ARG:2 / 5)  ; 背德感
		
	CASE 6  ; 露出
		CALL UPDATE_BODY_GROWTH, 1, 33, ARG:2 * 3  ; 露出经验
		CALL SET_PALAM, 1, 21, MIN(100, GET_PALAM(1, 21) + ARG:2 / 10)  ; 露出欲
		CALL SET_PALAM, 1, 82, MIN(100, GET_PALAM(1, 82) + ARG:2 / 20)  ; 皮肤敏感度
		CALL SET_PALAM, 1, 36, MIN(100, GET_PALAM(1, 36) + ARG:2 / 15)  ; 羞耻心下降
		
	CASE 7  ; 束缚
		CALL UPDATE_BODY_GROWTH, 1, 34, ARG:2 * 3  ; 束缚经验
		CALL SET_PALAM, 1, 23, MIN(100, GET_PALAM(1, 23) + ARG:2 / 10)  ; 被虐欲
		CALL SET_PALAM, 1, 18, MIN(100, GET_PALAM(1, 18) + ARG:2 / 10)  ; 服从度
		CALL SET_PALAM, 1, 36, MIN(100, GET_PALAM(1, 36) + ARG:2 / 15)  ; 羞辱经验
		
	CASE 8  ; 羞辱
		CALL UPDATE_BODY_GROWTH, 1, 35, ARG:2 * 4  ; 羞辱经验
		CALL SET_PALAM, 1, 17, MIN(100, GET_PALAM(1, 17) + ARG:2 / 5)  ; 屈辱感
		CALL SET_PALAM, 1, 18, MIN(100, GET_PALAM(1, 18) + ARG:2 / 10)  ; 服从度
		CALL SET_PALAM, 1, 19, MIN(100, GET_PALAM(1, 19) + ARG:2 / 15)  ; 依赖度
ENDSELECT

; 共通效果
CALL SET_PALAM, 1, 20, MIN(100, GET_PALAM(1, 20) + ARG:2 / 20)  ; 淫乱度
CALL SET_PALAM, 1, 13, MIN(100, GET_PALAM(1, 13) + ARG:2 / 10)  ; 满足度
CALL SET_PALAM, 1, 14, MAX(0, GET_PALAM(1, 14) - ARG:2 / 15)  ; 羞耻心下降

; 体力消耗
CALL SET_PALAM, 1, 0, MAX(0, GET_PALAM(1, 0) - ARG:3 * 5)  ; 体力
CALL SET_PALAM, 1, 2, MAX(0, GET_PALAM(1, 2) - ARG:3 * 3)  ; 精力

RETURN

@CHECK_BREAST_GROWTH_TRIGGER
; 检查胸部成长触发
LOCAL = GET_PALAM(1, 29)  ; 乳交经验

IF LOCAL >= 50 AND LOCAL < 100 AND RAND:100 < 10
	PRINTL 【频繁的胸部刺激让你的乳房开始发育...】
	PRINTL 【胸部感觉变大了...】
	CALL SET_PALAM, 1, 42, GET_PALAM(1, 42) + 2
	CALL SET_PALAM, 1, 37, GET_PALAM(1, 37) + 3
ELSEIF LOCAL >= 100 AND LOCAL < 200 AND RAND:100 < 15
	PRINTL 【你的乳房在持续的刺激下不断成长...】
	PRINTL 【已经可以明显看出变大了...】
	CALL SET_PALAM, 1, 42, GET_PALAM(1, 42) + 3
	CALL SET_PALAM, 1, 37, GET_PALAM(1, 37) + 4
ELSEIF LOCAL >= 200 AND RAND:100 < 20
	PRINTL 【你的乳房已经发育到惊人的程度...】
	PRINTL 【轻轻一动就会摇晃不停...】
	CALL SET_PALAM, 1, 42, GET_PALAM(1, 42) + 4
	CALL SET_PALAM, 1, 37, GET_PALAM(1, 37) + 5
ENDIF
RETURN

@CHECK_VAGINA_LOOSENING_TRIGGER
; 检查小穴松弛触发
LOCAL = GET_PALAM(1, 30)  ; 性交经验

IF LOCAL >= 50 AND LOCAL < 100 AND RAND:100 < 10
	PRINTL 【频繁的性交让你的小穴开始松弛...】
	PRINTL 【感觉没有以前那么紧了...】
	CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - 3)
	CALL SET_PALAM, 1, 51, GET_PALAM(1, 51) + 1
ELSEIF LOCAL >= 100 AND LOCAL < 200 AND RAND:100 < 15
	PRINTL 【你的小穴在持续的插入下逐渐松弛...】
	PRINTL 【已经可以明显感觉到变大了...】
	CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - 5)
	CALL SET_PALAM(1, 51, GET_PALAM(1, 51) + 2
ELSEIF LOCAL >= 200 AND RAND:100 < 20
	PRINTL 【你的小穴已经松弛到可以轻松容纳粗大的肉棒...】
	PRINTL 【插入时几乎没有阻力了...】
	CALL SET_PALAM, 1, 52, MAX(0, GET_PALAM(1, 52) - 8)
	CALL SET_PALAM, 1, 51, GET_PALAM(1, 51) + 3
ENDIF
RETURN

@DAILY_BODY_UPDATE
; 每日身体状态更新
IF FLAG:72 == 1  ; 女性线
	; 胸部泌乳减少
	IF GET_PALAM(1, 5) > 0
		CALL SET_PALAM, 1, 5, MAX(0, GET_PALAM(1, 5) - 5)
	ENDIF
	
	; 爱液分泌减少
	IF GET_PALAM(1, 58) > 0
		CALL SET_PALAM, 1, 58, MAX(0, GET_PALAM(1, 58) - 10)
	ENDIF
	
	; 体力精力恢复
	CALL SET_PALAM, 1, 0, MIN(100, GET_PALAM(1, 0) + 30)
	CALL SET_PALAM, 1, 2, MIN(100, GET_PALAM(1, 2) + 20)
	
	; 检查成长触发
	GOSUB CHECK_BREAST_GROWTH_TRIGGER
	GOSUB CHECK_VAGINA_LOOSENING_TRIGGER
ENDIF
RETURN